<div class="dashboard-container">

    <div class="page-header">
        <h1>Dashboard</h1>
    </div>

    <mat-card class="filter-card" appearance="outlined">
        <mat-card-content>
            <div class="filter-row">
                <select class="filter-select" [(ngModel)]="selectedMonth">
                    @for (month of months; track month.value) {
                    <option [value]="month.value">{{ month.label }}</option>
                    }
                </select>

                <select class="filter-select" [(ngModel)]="selectedYear">
                    @for (year of years; track year) {
                    <option [value]="year">{{ year }}</option>
                    }
                </select>

                <button mat-raised-button class="load-button" (click)="loadReport()">
                    <mat-icon>bar_chart</mat-icon>
                    Load Report
                </button>
            </div>
        </mat-card-content>
    </mat-card>
    <!-- Loading -->
    @if (loading) {
    <div class="spinner-container">
        <mat-spinner diameter="48" />
    </div>
    }

    <!-- Error -->
    @if (error) {
    <mat-card class="error-card">
        <mat-card-content>
            <mat-icon>error_outline</mat-icon>
            <p>{{ error }}</p>
        </mat-card-content>
    </mat-card>
    }

    <!-- Content -->
    @if (!loading && !error && summary) {

    <!-- Summary cards -->
    <div class="summary-cards">
        <mat-card class="summary-card" appearance="outlined">
            <mat-card-content>
                <div class="summary-row">
                    <mat-icon class="summary-icon">payments</mat-icon>
                    <div>
                        <div class="summary-label">Total Payments</div>
                        <div class="summary-value">{{ summary.totalCount }}</div>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="summary-card" appearance="outlined">
            <mat-card-content>
                <div class="summary-row">
                    <mat-icon class="summary-icon">account_balance</mat-icon>
                    <div>
                        <div class="summary-label">Total Amount</div>
                        <div class="summary-value">{{ summary.totalAmount | currency:'ZAR':'symbol-narrow' }}</div>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="summary-card" appearance="outlined">
            <mat-card-content>
                <div class="summary-row">
                    <mat-icon class="summary-icon">business</mat-icon>
                    <div>
                        <div class="summary-label">Active Providers</div>
                        <div class="summary-value">{{ summary.byProvider.length }}</div>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- Provider breakdown -->
    <mat-card appearance="outlined">
        <mat-card-header>
            <mat-card-title>Provider Breakdown</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            @if (summary.byProvider.length === 0) {
            <p class="no-data">No payments found for this period.</p>
            } @else {
            <table mat-table [dataSource]="summary.byProvider" class="provider-table">

                <ng-container matColumnDef="providerCode">
                    <th mat-header-cell *matHeaderCellDef>Code</th>
                    <td mat-cell *matCellDef="let p">{{ p.providerCode }}</td>
                </ng-container>

                <ng-container matColumnDef="providerName">
                    <th mat-header-cell *matHeaderCellDef>Provider</th>
                    <td mat-cell *matCellDef="let p">{{ p.providerName }}</td>
                </ng-container>

                <ng-container matColumnDef="totalAmount">
                    <th mat-header-cell *matHeaderCellDef>Total Amount</th>
                    <td mat-cell *matCellDef="let p">
                        {{ p.totalAmount | currency:'ZAR':'symbol-narrow' }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="count">
                    <th mat-header-cell *matHeaderCellDef>Transactions</th>
                    <td mat-cell *matCellDef="let p">{{ p.count }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="providerColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: providerColumns"></tr>

            </table>
            }
        </mat-card-content>
    </mat-card>

    }

</div>