<div class="customer-list-container">

    <div class="page-header">
        <h1>Customers</h1>
        <button mat-raised-button class="onboard-button" (click)="onboard()">
            <mat-icon>person_add</mat-icon>
            Onboard
        </button>
    </div>

    <!-- Search -->
    <mat-card class="search-card">
        <mat-card-content>
            <div class="search-row">

                <!-- Toggle buttons for search type -->
                <div class="search-toggle">
                    <button [class.active-toggle]="searchType === 'ID'"
                        (click)="searchType = 'ID'; clearSearch()">ID</button>
                    <button [class.active-toggle]="searchType === 'Mobile'"
                        (click)="searchType = 'Mobile'; clearSearch()">Mobile</button>
                </div>

                <mat-form-field appearance="outline" class="search-input" subscriptSizing="dynamic">
                    <mat-label>Enter {{ searchType }}...</mat-label>
                    <input matInput [(ngModel)]="searchValue" (keyup.enter)="search()">
                    @if (searchValue) {
                    <button matSuffix mat-icon-button (click)="clearSearch()">
                        <mat-icon>close</mat-icon>
                    </button>
                    }
                </mat-form-field>

                <button mat-raised-button color="primary" class="search-button" (click)="search()"
                    [disabled]="searching">
                    @if (searching) {
                    <mat-spinner diameter="20" />
                    } @else {
                    Search
                    }
                </button>

            </div>

            @if (searchError) {
            <p class="search-error">{{ searchError }}</p>
            }
        </mat-card-content>
    </mat-card>

    <!-- Loading -->
    @if (loadingList) {
    <div class="spinner-container">
        <mat-spinner diameter="48" />
    </div>
    }

    <!-- Error -->
    @if (listError) {
    <mat-card class="error-card">
        <mat-card-content>
            <mat-icon>error_outline</mat-icon>
            <p>Failed to load customers. Is the backend running?</p>
        </mat-card-content>
    </mat-card>
    }

    <!-- Table -->
    @if (!loadingList && !listError) {
    <mat-card>
        <mat-card-header>
            <mat-card-title>All Customers ({{ displayedCustomers.length }})</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <table mat-table [dataSource]="displayedCustomers" class="customer-table">

                <ng-container matColumnDef="customerId">
                    <th mat-header-cell *matHeaderCellDef>ID</th>
                    <td mat-cell *matCellDef="let c">{{ c.customerId }}</td>
                </ng-container>

                <ng-container matColumnDef="firstName">
                    <th mat-header-cell *matHeaderCellDef>First Name</th>
                    <td mat-cell *matCellDef="let c">{{ c.firstName }}</td>
                </ng-container>

                <ng-container matColumnDef="lastName">
                    <th mat-header-cell *matHeaderCellDef>Last Name</th>
                    <td mat-cell *matCellDef="let c">{{ c.lastName }}</td>
                </ng-container>

                <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef>Email</th>
                    <td mat-cell *matCellDef="let c">{{ c.email }}</td>
                </ng-container>

                <ng-container matColumnDef="mobileNumber">
                    <th mat-header-cell *matHeaderCellDef>Mobile</th>
                    <td mat-cell *matCellDef="let c">{{ c.mobileNumber }}</td>
                </ng-container>

                <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let c">
                        <button mat-icon-button color="primary" (click)="goToCustomer(c.customerId)">
                            <mat-icon>arrow_forward</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

            </table>
        </mat-card-content>
    </mat-card>
    }

</div>